xblocks_devel
=============
This library contains scripting functions for building fixed-point DSP 
for Xilinx FPGAs using the XSG (Xilinx System Generator) tool, associated 
functional implementations of those blocks using MATLAB's fixed-point libraries,
and testing infrastructure for verification that the blocks work.

Configuring MATLAB & Simulink
=============================
Add the following lines (or similar) to your MATLAB startup.m file:

```code
homedir = getenv('HOME');
xblocks_lib_path = 'lib/xblocks_devel/xblocks_library';
addpath(fullfile(homedir, xblocks_lib_path))
addpath(fullfile(homedir, xblocks_lib_path, 'Testing'))
addpath(fullfile(homedir, xblocks_lib_path, 'Testing/util'))
addpath(fullfile(homedir, xblocks_lib_path, 'matlab_data_xfer'))
addpath(fullfile(homedir, xblocks_lib_path, 'dsp48e_util_lib'))
addpath(fullfile(homedir, xblocks_lib_path, 'fixed_point_dsp'))
addpath(fullfile(homedir, xblocks_lib_path, 'scripting'))
addpath(fullfile(homedir, xblocks_lib_path, 'automation'))
addpath(fullfile(homedir, xblocks_lib_path, 'gen_test_signals'))
```
where xblocks_lib_path should change depending on where you've checked out
the repository. An example file appears in
```code xblocks_library/startup.m```

To speed block drawing and avoid pointless scolling, Simulink provides 
a way to customize the ordering of the blocks and various other features
of the library browser.  To make all the relevant libraries appear in a useful
order,
```code
ln -s $HOME/lib/xblocks_library/sl_customization.m $HOME/Documents/MATLAB/sl_customization.m
```

Testing infrastructure
======================
Testbenches for this library are handled primarily through MATLAB functional 
validation. Simulation data is generated by MATLAB, transferred to the Simulink model
for simulation, and the results are dumped back to MATLAB for validation. The 
(poorly named) simulink_xsg_bridge library contains a set of blocks that transfer MATLAB
variables, both real and complex, to their respective Xilinx-compatible data types, 
as well as a set of blocks to transfer data from Simulink to MATLAB data types. 

All test cases are stored in subdirectories of 
```code
addpath(fullfile(homedir, xblocks_lib_path, 'Testing'))
```

New testbenches should be created by:

1. mkdir testing/blktype/subblkname; cd testing/blktype/subblkname where 'blktype'  is a categorization for the block (e.g. fft, vacc, binary_signal, etc.) and subblkname is the name of the actual block being tested, i.e. the init script would be named <subblkname>_init_xblock.m

2. Call the function create_tb.m, which should be on the path if startup.m was properly set.  This will create 2 files, a testbench script file and a simulnk model file. 

3. From the Simulink library browser, pull appropriate blocks from the 'MATLAB data xfer' library, which has been configured to be the browser name  for the simulink_xsg_bridge library file if you followed the step for the sl_customization.m file above.
